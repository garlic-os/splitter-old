<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/common.css">
	<title>Upload | Splitter</title>
</head>
<body>
	<input type="file" id="file" />
	<br />
	<button id="upload">Upload</button>
	<br />
	<p id="status"></p>

	<script>
		const token = new URL(window.location).searchParams.get("token");

		const fileInput = document.getElementById("file");
		const uploadButton = document.getElementById("upload");
		const statusText = document.getElementById("status");

		uploadButton.addEventListener("click", async () => {
			statusText.innerText = `üì§ Uploading...`;
			/**
			 * @type {File}
			 */
			const file = fileInput.files[0];
			try {
				const response = await fetch("/file", {
					method: "PUT",
					headers: {
						"Authorization": token,
						"X-Filename": file.name,
					},
					body: file,
				});
				switch (response.status) {
					case 201:
						statusText.innerText = `‚úÖ Upload complete!\nDownload here: ${await response.text()}`;
						break;
					case 401:
						statusText.innerText = "‚ùå Token has expired or is invalid.";
						break;
					default:
						console.error({response});
						statusText.innerText = "‚ùå Unexpected response from the server. Check the console for more info.";
				}
			} catch (error) {
				console.error(error);
				statusText.innerText = "‚ùå Failed to upload the file. Check the console for more info.";
			}
		});
	</script>
</body>
</html>